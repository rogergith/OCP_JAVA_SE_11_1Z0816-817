**Trabajando con _Streams_ Primitivos**

Hasta ahora, todos los _streams_ que hemos creado han usado la clase `Stream` con un tipo genérico, como `Stream<String>`, `Stream<Integer>`, etc. Para valores numéricos, hemos estado utilizando las clases _wrapper_ que aprendiste en el capítulo 14. Hicimos esto con la API de _Collections_ para que te resultara natural.

En realidad, Java incluye otras clases de _streams_, además de `Stream`, que puedes usar para trabajar con tipos primitivos específicos: `int`, `double` y `long`. Veamos por qué esto es necesario. Supongamos que queremos calcular la suma de los números en un _stream_ finito:

```java
Stream<Integer> stream = Stream.of(1, 2, 3);
System.out.println(stream.reduce(0, (s, n) -> s + n)); // 6
```

No está mal. No fue difícil escribir una reducción. Iniciamos el acumulador en cero y, luego, sumamos cada número a ese total a medida que aparecía en el _stream_. Hay otra forma de hacer esto, como se ve aquí:

```java
Stream<Integer> stream = Stream.of(1, 2, 3);
System.out.println(stream.mapToInt(x -> x).sum()); // 6
```

Esta vez convertimos nuestro `Stream<Integer>` en un `IntStream` y le pedimos a `IntStream` que calcule la suma por nosotros. Un `IntStream` tiene muchos de los mismos métodos intermedios y terminales que un `Stream`, pero incluye métodos especializados para trabajar con datos numéricos. Los _streams_ primitivos saben cómo realizar ciertas operaciones comunes de forma automática.

Hasta ahora, esto parece una ventaja interesante, pero no muy trascendental. Ahora piensa en cómo calcularías un promedio. Necesitas dividir la suma entre el número de elementos. El problema es que los _streams_ permiten solo un paso. Java reconoce que calcular un promedio es una tarea común y, por ello, proporciona un método para calcular el promedio en las clases de _streams_ para primitivos:

```java
IntStream intStream = IntStream.of(1, 2, 3);
OptionalDouble avg = intStream.average();
System.out.println(avg.getAsDouble()); // 2.0
```

No solo es posible calcular el promedio, sino que también es muy fácil hacerlo. Está claro que los _streams_ primitivos son importantes. Veremos cómo crearlos y utilizarlos, incluyendo el uso de _optionals_ e interfaces funcionales.

### Creación de _Streams_ Primitivos

Existen tres tipos de _streams_ primitivos:

- `IntStream`: se utiliza para los tipos primitivos `int`, `short`, `byte` y `char`.
- `LongStream`: se utiliza para el tipo primitivo `long`.
- `DoubleStream`: se utiliza para los tipos primitivos `double` y `float`.

¿Por qué no tiene cada tipo primitivo su propio _stream_ primitivo? Estos tres son los más comunes, por lo que los diseñadores de la API optaron por ellos.

> **Cuando veas la palabra *stream* en el examen**, presta atención a las mayúsculas. Con “S” mayúscula o en el código, `Stream` es el nombre de una clase que contiene un tipo `Object`. Con “s” minúscula, un *stream* es un concepto que puede ser un `Stream`, `DoubleStream`, `IntStream` o `LongStream`.

La **Tabla 15.7** muestra algunos de los métodos que son exclusivos de los _streams_ primitivos. Observa que no incluimos en la tabla métodos como `empty()`, que ya conoces de la interfaz `Stream`.

---

**Tabla 15.7 Métodos comunes de _streams_ primitivos**

| Método                               | _Stream_ primitivo                 | Descripción                                                                                                       |
|--------------------------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| `OptionalDouble average()`           | `IntStream`<br>`LongStream`<br>`DoubleStream` | Calcula la media aritmética de los elementos                                                                     |
| `Stream<T> boxed()`                 | `IntStream`<br>`LongStream`<br>`DoubleStream` | Devuelve un `Stream<T>` donde `T` es la clase *wrapper* asociada con el valor primitivo                           |
| `OptionalInt max()`                 | `IntStream`                         | Devuelve el elemento máximo del _stream_                                                                          |
| `OptionalLong max()`                | `LongStream`                        | Lo mismo, para `LongStream`                                                                                      |
| `OptionalDouble max()`              | `DoubleStream`                      | Lo mismo, para `DoubleStream`                                                                                    |
| `OptionalInt min()`                 | `IntStream`                         | Devuelve el elemento mínimo del _stream_                                                                          |
| `OptionalLong min()`                | `LongStream`                        | Lo mismo, para `LongStream`                                                                                      |
| `OptionalDouble min()`              | `DoubleStream`                      | Lo mismo, para `DoubleStream`                                                                                    |
| `IntStream range(int a, int b)`     | `IntStream`                         | Devuelve un _stream_ primitivo desde `a` (incluido) hasta `b` (excluido)                                         |
| `LongStream range(long a, long b)`  | `LongStream`                        | Versión para `long`                                                                                              |
| `IntStream rangeClosed(int a, int b)` | `IntStream`                         | Devuelve un _stream_ primitivo desde `a` (incluido) hasta `b` (incluido)                                         |
| `LongStream rangeClosed(long a, long b)` | `LongStream`                    | Versión para `long`                                                                                              |
| `int sum()`                         | `IntStream`                         | Devuelve la suma de los elementos en el _stream_                                                                 |
| `long sum()`                        | `LongStream`                        | Versión para `LongStream`                                                                                       |
| `double sum()`                      | `DoubleStream`                      | Versión para `DoubleStream`                                                                                     |
| `IntSummaryStatistics summaryStatistics()` | `IntStream`               | Devuelve un objeto con múltiples estadísticas del _stream_ como promedio, mínimo, máximo, etc.                   |
| `LongSummaryStatistics summaryStatistics()` | `LongStream`            | Versión para `LongStream`                                                                                       |
| `DoubleSummaryStatistics summaryStatistics()` | `DoubleStream`        | Versión para `DoubleStream`                                                                                     |

---

Algunos de los métodos para crear un _stream_ primitivo son equivalentes a cómo creamos la fuente de un `Stream` normal. Puedes crear un _stream_ vacío así:

```java
DoubleStream empty = DoubleStream.empty();
```

Otra forma es usar el método de fábrica `of()` con un único valor o empleando la versión con *varargs*:

```java
DoubleStream oneValue = DoubleStream.of(3.14);
oneValue.forEach(System.out::println);

DoubleStream varargs = DoubleStream.of(1.0, 1.1, 1.2);
varargs.forEach(System.out::println);
```

Este código produce la siguiente salida:
```
3.14
1.0
1.1
1.2
```

También puedes utilizar dos métodos para crear _streams_ infinitos, tal como hicimos con `Stream`.

```java
var random = DoubleStream.generate(Math::random);
var fractions = DoubleStream.iterate(.5, d -> d / 2);
random.limit(3).forEach(System.out::println);
fractions.limit(3).forEach(System.out::println);
```

Como los _streams_ son infinitos, agregamos la operación intermedia `limit` para que la salida no imprima valores para siempre. El primer _stream_ llama a un método estático de `Math` para obtener un número aleatorio tipo `double`. Dado que los números son aleatorios, tu salida obviamente será diferente. El segundo _stream_ sigue generando números cada vez más pequeños, dividiendo el valor anterior entre dos en cada iteración. La salida que obtuvimos al ejecutar este código fue:

```
0.07890654781186413
0.28564363465842346
0.6311403511266134
0.5
0.25
0.125
```

No es necesario que sepas esto para el examen, pero la clase `Random` proporciona un método para obtener _streams_ primitivos de números aleatorios directamente. ¡Un dato curioso! Por ejemplo, `ints()` genera un `IntStream` infinito de primitivos.

Funciona de la misma manera para cada tipo de _stream_ primitivo. Cuando trabajamos con primitivos `int` o `long`, es común contar. Supongamos que queremos un _stream_ con los números del 1 al 5. Podríamos escribir:

```java
IntStream count = IntStream.iterate(1, n -> n + 1).limit(5);
count.forEach(System.out::println);
```

Este código sí imprime los números del 1 al 5, uno por línea. Sin embargo, es mucho código para algo tan sencillo. Java proporciona un método que puede generar un rango de números:

```java
IntStream range = IntStream.range(1, 6);
range.forEach(System.out::println);
```

Esto es mejor. Si queríamos los números del 1 al 5, ¿por qué pasamos del 1 al 6? El primer parámetro del método `range()` es inclusivo, lo que significa que incluye el número. El segundo parámetro es exclusivo, por lo que se detiene justo antes de ese número. Aun así, podría ser más claro. Queremos los números del 1 al 5 inclusivos. Por suerte, hay otro método, `rangeClosed()`, que es inclusivo para ambos parámetros:

```java
IntStream rangeClosed = IntStream.rangeClosed(1, 5);
rangeClosed.forEach(System.out::println);
```

Mucho mejor. Esta vez expresamos que queremos un rango cerrado, o un rango inclusivo. Este método se ajusta mejor a la forma en que expresamos un rango de números en lenguaje natural.
